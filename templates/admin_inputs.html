<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Inputs</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        body { font-family: Arial, sans-serif; background: #f9f9f9; }
        .admin-container { display: flex; flex-direction: row; min-height: 600px; max-width: 1200px; width: 1000px; margin: 12px auto; padding: 0px 16px; border-radius: 8px; background: #f9f9f9; }
        h1 { text-align: center; }
        form { display: flex; flex-direction: column; gap: 10px; }
        label { font-weight: bold; }
        input, textarea { padding: 7px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; }
        button { padding: 10px; margin-top: 10px; width: 50%; background: black; color: #fff; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; }
        button:hover { background: gray; color: white; }
        .success, .error { margin-top: 10px; text-align: center; font-weight: bold; }
        .success { color: green; }
        .error { color: red; }
        .tab-btn {
            padding: 14px 0 14px 18px;
            border-radius: 0 18px 18px 0;
            border: none;
            background: none;
            font-size: 17px;
            color: #333;
            text-align: left;
            opacity: 0.7;
            font-weight: normal;
            margin: 0;
            width: 100%;
            transition: background 0.15s, color 0.15s, opacity 0.15s;
        }
        .tab-btn.active {
            background: #fff;
            color: #111;
            opacity: 1;
            font-weight: bold;
            box-shadow: 2px 0 8px rgba(0,0,0,0.04);
        }
        #admin-tabs {
            background: #f9f9f9;
            border-right: 1px solid #ddd;
            min-width: 210px;
            padding: 24px 0 0 0;
            gap: 0;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .tab-btn:hover {
            background: #f7f7f7;
            color: #111;
            opacity: 1;
        }
        #tags-input-container, #options-input-container, #weighted-tags-input-container {
            min-height: 32px !important;
            padding: 3px 5px !important;
        }
        #images-upload-container, #weighted-images-upload-container {
            padding: 12px !important;
            margin-bottom: 6px !important;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #images-upload-text, #weighted-images-upload-text {
            display: inline-block;
            width: 100%;
            text-align: center;
            vertical-align: middle;
        }
        #images-preview, #weighted-images-preview {
            gap: 6px !important;
            margin-top: 6px !important;
        }
        nav {
            width: 210px;
            min-height: 100vh;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: #f1f1f1;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: 24px 0 0 0;
            gap: 8px;
            z-index: 1000;
            justify-content: space-between;
        }
        .nav-logo {
            width: 120px;
            margin: 10px auto 18px auto;
            display: block;
            opacity: 0.85;
            padding-bottom: 30px;
        }
        .nav-btns {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }
        .nav-submenu {
            display: none;
            flex-direction: column;
            position: absolute;
            left: 210px;
            top: 2px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            z-index: 2000;
            min-width: 160px;
        }
        .nav-submenu button {
            background: none;
            border: none;
            color: #333;
            font-size: 16px;
            padding: 10px 18px;
            text-align: left;
            border-radius: 0;
            cursor: pointer;
            opacity: 1;
            width: 100%; /* Make submenu buttons full width */
            box-sizing: border-box;
            display: block;
        }
        .nav-submenu button:hover {
            background: #f1f1f1;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: 210px;
        }
    </style>
    <script>
        function submitProduct() {
            const product_name = document.getElementById('product-name').value.trim();
            const price = parseFloat(document.getElementById('product-price').value);
            const cost = parseFloat(document.getElementById('product-cost').value);
            const description = document.getElementById('product-description').value;
            const original_price = document.getElementById('product-original-price').value;
            const group = document.getElementById('product-group').value.trim();
            const imagesInput = document.getElementById('product-images-input');

            if (!product_name || isNaN(price) || isNaN(cost)) {
                showMessage('Please fill out all required fields.', false);
                return;
            }

            // Only include non-required fields if they have a value
            const payload = {
                product_name,
                price,
                cost
            };
            if (description && description.trim() !== "") payload.description = description.trim();
            if (original_price !== "") payload.original_price = parseFloat(original_price);
            if (group !== "") payload.group = group;
            if (tags.length > 0) payload.tags = tags;
            if (options.length > 0) payload.options = options;

            // Prepare form data for images
            const formData = new FormData();
            for (let i = 0; i < imagesInput.files.length; i++) {
                formData.append('images', imagesInput.files[i]);
            }
            formData.append('payload', JSON.stringify(payload));
            formData.append('bucket', 'product-images');

            // Remove imagesInput.value reset here so files persist after submit
            fetch('/api/add-product', {
                method: 'POST', 
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    showMessage(data.message, true);
                    document.getElementById('admin-form').reset();
                    // Also clear preview and show upload text
                    imagesPreview.innerHTML = '';
                    imagesUploadText.style.display = 'inline';
                } else {
                    showMessage('Product could not be added. Please ensure that all groups and tags added can be found in the admin console.', false);
                }
            })
            .catch(error => {
                showMessage('Product could not be added. Please ensure that all groups and tags added can be found in the admin console.', false);
            });
        }

        function showMessage(msg, success) {
            const msgDiv = document.getElementById('admin-message');
            msgDiv.textContent = msg;
            msgDiv.className = success ? 'success' : 'error';
        }

        // Tab switching logic
        function initTabs() {
            const tabAddProduct = document.getElementById('tab-add-product');
            const tabAddFlower = document.getElementById('tab-add-flower');
            const tabAddBXGOGroup = document.getElementById('tab-add-bxgo-group');
            const tabAddPromoCode = document.getElementById('tab-add-promo-code');
            const tabAddTag = document.getElementById('tab-add-tag');
            const tabAddFlowerPriceTier = document.getElementById('tab-add-flower-price-tier');
            const addProductSection = document.getElementById('add-product-section');
            const addFlowerSection = document.getElementById('add-flower-section');
            const addBXGOGroupSection = document.getElementById('add-bxgo-group-section');
            const addPromoCodeSection = document.getElementById('add-promo-code-section');
            const addTagSection = document.getElementById('add-tag-section');
            const addFlowerPriceTierSection = document.getElementById('add-flower-price-tier-section');

            function hideAllSections() {
                addProductSection.style.display = 'none';
                addFlowerSection.style.display = 'none';
                addBXGOGroupSection.style.display = 'none';
                addPromoCodeSection.style.display = 'none';
                addTagSection.style.display = 'none';
                addFlowerPriceTierSection.style.display = 'none';
            }
            function deactivateAllTabs() {
                tabAddProduct.classList.remove('active');
                tabAddFlower.classList.remove('active');
                tabAddBXGOGroup.classList.remove('active');
                tabAddPromoCode.classList.remove('active');
                tabAddTag.classList.remove('active');
                tabAddFlowerPriceTier.classList.remove('active');
            }
            tabAddProduct.onclick = function() {
                deactivateAllTabs();
                tabAddProduct.classList.add('active');
                hideAllSections();
                addProductSection.style.display = '';
            };
            tabAddFlower.onclick = function() {
                deactivateAllTabs();
                tabAddFlower.classList.add('active');
                hideAllSections();
                addFlowerSection.style.display = '';
            };
            tabAddBXGOGroup.onclick = function() {
                deactivateAllTabs();
                tabAddBXGOGroup.classList.add('active');
                hideAllSections();
                addBXGOGroupSection.style.display = '';
            };
            tabAddPromoCode.onclick = function() {
                deactivateAllTabs();
                tabAddPromoCode.classList.add('active');
                hideAllSections();
                addPromoCodeSection.style.display = '';
            };
            tabAddTag.onclick = function() {
                deactivateAllTabs();
                tabAddTag.classList.add('active');
                hideAllSections();
                addTagSection.style.display = '';
            };
            tabAddFlowerPriceTier.onclick = function() {
                deactivateAllTabs();
                tabAddFlowerPriceTier.classList.add('active');
                hideAllSections();
                addFlowerPriceTierSection.style.display = '';
            };
            // Trigger click on the first tab to set initial state
            tabAddProduct.click();
        }

        document.addEventListener('DOMContentLoaded', function() {
            initTabs();
            // Profit Reports submenu logic
            const profitBtn = document.getElementById('profit-reports-btn');
            const submenu = document.getElementById('profit-reports-submenu');
            let submenuTimeout;
            profitBtn.addEventListener('mouseenter', function() {
                clearTimeout(submenuTimeout);
                submenu.style.display = 'flex';
            });
            profitBtn.addEventListener('mouseleave', function() {
                submenuTimeout = setTimeout(() => submenu.style.display = 'none', 200);
            });
            submenu.addEventListener('mouseenter', function() {
                clearTimeout(submenuTimeout);
                submenu.style.display = 'flex';
            });
            submenu.addEventListener('mouseleave', function() {
                submenuTimeout = setTimeout(() => submenu.style.display = 'none', 200);
            });

            // Delete Product Modal logic
            const openDeleteProductModalBtn = document.getElementById('open-delete-product-modal');
            const deleteProductModal = document.getElementById('delete-product-modal');
            const closeDeleteProductModalBtn = document.getElementById('close-delete-product-modal');
            const deleteProductBtn = document.getElementById('delete-product-btn');
            const deleteProductMessage = document.getElementById('delete-product-message');

            openDeleteProductModalBtn.addEventListener('click', function() {
                deleteProductModal.style.display = 'flex';
                deleteProductMessage.textContent = '';
                document.getElementById('delete-product-id').value = '';
                document.getElementById('delete-product-id').focus();
            });

            deleteProductBtn.addEventListener('click', function() {
                const productId = document.getElementById('delete-product-id').value.trim();
                if (!productId) {
                    deleteProductMessage.textContent = 'Please enter a product ID.';
                    deleteProductMessage.className = 'error';
                    return;
                }
                deleteProductMessage.textContent = 'Deleting...';
                deleteProductMessage.className = '';
                fetch('/api/delete-product', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product_id: productId })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.message) {
                        deleteProductMessage.textContent = data.message;
                        deleteProductMessage.className = 'success';
                    } else {
                        deleteProductMessage.textContent = data.error || 'Failed to delete product.';
                        deleteProductMessage.className = 'error';
                    }
                })
                .catch(() => {
                    deleteProductMessage.textContent = 'Failed to delete product.';
                    deleteProductMessage.className = 'error';
                });
            });
            closeDeleteProductModalBtn.addEventListener('click', function() {
                deleteProductModal.style.display = 'none';
            });
            deleteProductModal.addEventListener('click', function(e) {
                if (e.target === deleteProductModal) deleteProductModal.style.display = 'none';
            });

            // Delete Weighted Product Modal logic
            const openDeleteWeightedProductModalBtn = document.getElementById('open-delete-weighted-product-modal');
            const deleteWeightedProductModal = document.getElementById('delete-weighted-product-modal');
            const closeDeleteWeightedProductModalBtn = document.getElementById('close-delete-weighted-product-modal');
            const deleteWeightedProductBtn = document.getElementById('delete-weighted-product-btn');
            const deleteWeightedProductMessage = document.getElementById('delete-weighted-product-message');

            if (openDeleteWeightedProductModalBtn && deleteWeightedProductModal && closeDeleteWeightedProductModalBtn && deleteWeightedProductBtn && deleteWeightedProductMessage) {
                openDeleteWeightedProductModalBtn.addEventListener('click', function() {
                    deleteWeightedProductModal.style.display = 'flex';
                    deleteWeightedProductMessage.textContent = '';
                    document.getElementById('delete-weighted-product-id').value = '';
                    document.getElementById('delete-weighted-product-id').focus();
                });

                deleteWeightedProductBtn.addEventListener('click', function() {
                    const productId = document.getElementById('delete-weighted-product-id').value.trim();
                    if (!productId) {
                        deleteWeightedProductMessage.textContent = 'Please enter a product ID.';
                        deleteWeightedProductMessage.className = 'error';
                        return;
                    }
                    deleteWeightedProductMessage.textContent = 'Deleting...';
                    deleteWeightedProductMessage.className = '';
                    fetch('/api/delete-weighted-product', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ product_id: productId })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.message) {
                            deleteWeightedProductMessage.textContent = data.message;
                            deleteWeightedProductMessage.className = 'success';
                        } else {
                            deleteWeightedProductMessage.textContent = data.error || 'Failed to delete product.';
                            deleteWeightedProductMessage.className = 'error';
                        }
                    })
                    .catch(() => {
                        deleteWeightedProductMessage.textContent = 'Failed to delete product.';
                        deleteWeightedProductMessage.className = 'error';
                    });
                });
                closeDeleteWeightedProductModalBtn.addEventListener('click', function() {
                    deleteWeightedProductModal.style.display = 'none';
                });
                deleteWeightedProductModal.addEventListener('click', function(e) {
                    if (e.target === deleteWeightedProductModal) deleteWeightedProductModal.style.display = 'none';
                });
            }
        });

        // Tag modal logic
        const openTagModalBtn = document.getElementById('open-add-tag-modal');
        const tagModal = document.getElementById('add-tag-modal');
        const closeTagModalBtn = document.getElementById('close-add-tag-modal');
        openTagModalBtn.addEventListener('click', function() {
            tagModal.style.display = 'flex';
            document.getElementById('tag-name').focus();
            document.getElementById('add-tag-message').textContent = '';
        });
        closeTagModalBtn.addEventListener('click', function() {
            tagModal.style.display = 'none';
        });
        tagModal.addEventListener('click', function(e) {
            if (e.target === tagModal) tagModal.style.display = 'none';
        });
        function submitTag() {
            const tagName = document.getElementById('tag-name').value.trim();
            const msgDiv = document.getElementById('add-tag-message');
            if (!tagName) {
                msgDiv.textContent = 'Tag name is required.';
                msgDiv.className = 'error';
                return;
            }
            fetch('/api/add-tag', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: tagName })
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    msgDiv.textContent = data.message;
                    msgDiv.className = 'success';
                    document.getElementById('add-tag-form').reset();
                } else {
                    msgDiv.textContent = 'Could not add tag.';
                    msgDiv.className = 'error';
                }
            })
            .catch(() => {
                msgDiv.textContent = 'Could not add tag.';
                msgDiv.className = 'error';
            });
        }

        function submitPromoCode() {
            const code = document.getElementById('promo-code').value.trim();
            const dollarsOff = document.getElementById('dollars-off').value;
            const percentOff = document.getElementById('percent-off').value;
            const msgDiv = document.getElementById('add-promo-code-message');
            if (!code) {
                msgDiv.textContent = 'Promo code is required.';
                msgDiv.className = 'error';
                return;
            }
            const payload = { code };
            if (dollarsOff !== "") payload.dollars_off = parseFloat(dollarsOff);
            if (percentOff !== "") payload.percent_off = parseInt(percentOff);
            fetch('/api/add-promo-code', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    msgDiv.textContent = data.message;
                    msgDiv.className = 'success';
                    document.getElementById('add-promo-code-form').reset();
                } else {
                    msgDiv.textContent = 'Could not add promo code.';
                    msgDiv.className = 'error';
                }
            })
            .catch(() => {
                msgDiv.textContent = 'Could not add promo code.';
                msgDiv.className = 'error';
            });
        }

        function submitBXGOGroup() {
            const group = document.getElementById('bxgo-group').value.trim();
            const bogo = document.getElementById('bogo').checked;
            const b2go = document.getElementById('b2go').checked;
            const b3go = document.getElementById('b3go').checked;
            const msgDiv = document.getElementById('add-bxgo-group-message');
            if (!group) {
                msgDiv.textContent = 'Group name is required.';
                msgDiv.className = 'error';
                return;
            }
            const payload = { group, BOGO: bogo, B2GO: b2go, B3GO: b3go };
            fetch('/api/add-bxgo-group', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    msgDiv.textContent = data.message;
                    msgDiv.className = 'success';
                    document.getElementById('add-bxgo-group-form').reset();
                } else {
                    msgDiv.textContent = 'Could not add group.';
                    msgDiv.className = 'error';
                }
            })
            .catch(() => {
                msgDiv.textContent = 'Could not add group.';
                msgDiv.className = 'error';
            });
        }

        function submitFlowerPriceTier() {
            const tier = document.getElementById('tier').value;
            const discount4g = document.getElementById('discount-4g').value;
            const discount7g = document.getElementById('discount-7g').value;
            const discount14g = document.getElementById('discount-14g').value;
            const discount28g = document.getElementById('discount-28g').value;
            const msgDiv = document.getElementById('add-flower-price-tier-message');
            if (!tier) {
                msgDiv.textContent = 'Tier is required.';
                msgDiv.className = 'error';
                return;
            }
            const payload = { tier: parseInt(tier) };
            if (discount4g !== "") payload['4g_discount'] = parseFloat(discount4g);
            if (discount7g !== "") payload['7g_discount'] = parseFloat(discount7g);
            if (discount14g !== "") payload['14g_discount'] = parseFloat(discount14g);
            if (discount28g !== "") payload['28g_discount'] = parseFloat(discount28g);
            fetch('/api/add-flower-price-tier', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    msgDiv.textContent = data.message;
                    msgDiv.className = 'success';
                    document.getElementById('add-flower-price-tier-form').reset();
                } else {
                    msgDiv.textContent = 'Could not add flower price tier.';
                    msgDiv.className = 'error';
                }
            })
            .catch(() => {
                msgDiv.textContent = 'Could not add flower price tier.';
                msgDiv.className = 'error';
            });
        }

        // Delete Product Modal logic
        const openDeleteProductModalBtn = document.getElementById('open-delete-product-modal');
        const deleteProductModal = document.getElementById('delete-product-modal');
        const closeDeleteProductModalBtn = document.getElementById('close-delete-product-modal');
        const deleteProductBtn = document.getElementById('delete-product-btn');
        const deleteProductMessage = document.getElementById('delete-product-message');

        openDeleteProductModalBtn.addEventListener('click', function() {
            deleteProductModal.style.display = 'flex';
            deleteProductMessage.textContent = '';
            document.getElementById('delete-product-id').value = '';
            document.getElementById('delete-product-id').focus();
        });

        deleteProductBtn.addEventListener('click', function() {
            const productId = document.getElementById('delete-product-id').value.trim();
            if (!productId) {
                deleteProductMessage.textContent = 'Please enter a product ID.';
                deleteProductMessage.className = 'error';
                return;
            }
            deleteProductMessage.textContent = 'Deleting...';
            deleteProductMessage.className = '';
            fetch('/api/delete-product', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ product_id: productId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    deleteProductMessage.textContent = data.message;
                    deleteProductMessage.className = 'success';
                } else {
                    deleteProductMessage.textContent = data.error || 'Failed to delete product.';
                    deleteProductMessage.className = 'error';
                }
            })
            .catch(() => {
                deleteProductMessage.textContent = 'Failed to delete product.';
                deleteProductMessage.className = 'error';
            });
        });
        closeDeleteProductModalBtn.addEventListener('click', function() {
            deleteProductModal.style.display = 'none';
        });
        deleteProductModal.addEventListener('click', function(e) {
            if (e.target === deleteProductModal) deleteProductModal.style.display = 'none';
        });
        // For now, Delete Product button does nothing

        // Delete Weighted Product Modal logic
        const openDeleteWeightedProductModalBtn = document.getElementById('open-delete-weighted-product-modal');
        const deleteWeightedProductModal = document.getElementById('delete-weighted-product-modal');
        const closeDeleteWeightedProductModalBtn = document.getElementById('close-delete-weighted-product-modal');
        const deleteWeightedProductBtn = document.getElementById('delete-weighted-product-btn');
        const deleteWeightedProductMessage = document.getElementById('delete-weighted-product-message');

        openDeleteWeightedProductModalBtn.addEventListener('click', function() {
            deleteWeightedProductModal.style.display = 'flex';
            deleteWeightedProductMessage.textContent = '';
            document.getElementById('delete-weighted-product-id').value = '';
            document.getElementById('delete-weighted-product-id').focus();
        });

        deleteWeightedProductBtn.addEventListener('click', function() {
            const productId = document.getElementById('delete-weighted-product-id').value.trim();
            if (!productId) {
                deleteWeightedProductMessage.textContent = 'Please enter a product ID.';
                deleteWeightedProductMessage.className = 'error';
                return;
            }
            deleteWeightedProductMessage.textContent = 'Deleting...';
            deleteWeightedProductMessage.className = '';
            fetch('/api/delete-weighted-product', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ product_id: productId })
            })
            .then(res => res.json())
            .then(data => {
                if (data.message) {
                    deleteWeightedProductMessage.textContent = data.message;
                    deleteWeightedProductMessage.className = 'success';
                } else {
                    deleteWeightedProductMessage.textContent = data.error || 'Failed to delete product.';
                    deleteWeightedProductMessage.className = 'error';
                }
            })
            .catch(() => {
                deleteWeightedProductMessage.textContent = 'Failed to delete product.';
                deleteWeightedProductMessage.className = 'error';
            });
        });
        closeDeleteWeightedProductModalBtn.addEventListener('click', function() {
            deleteWeightedProductModal.style.display = 'none';
        });
        deleteWeightedProductModal.addEventListener('click', function(e) {
            if (e.target === deleteWeightedProductModal) deleteWeightedProductModal.style.display = 'none';
        });
    </script>
</head>
<body>
    <div style="display: flex; min-height: 100vh;">
        <nav>
            <div class="nav-btns">
                <button style="background: none; border: none; color: #333; font-size: 17px; padding: 14px 0; margin: 0 18px; border-radius: 5px; text-align: left; opacity: 0.7;" onclick="window.location.href='https://topcola.onrender.com/orders'; return false;">Orders</button>
                <button style="background: none; border: none; color: #333; font-size: 17px; padding: 14px 0; margin: 0 18px; border-radius: 5px; text-align: left; opacity: 0.7;" id="profit-reports-btn" type="button">Profit Reports</button>
                <div class="nav-submenu" id="profit-reports-submenu">
                    <button onclick="window.location.href='/profits-reports/7'">7 Days</button>
                    <button onclick="window.location.href='/profits-reports/14'">14 Days</button>
                    <button onclick="window.location.href='/profits-reports/30'">30 Days</button>
                    <button onclick="window.location.href='/profits-reports/60'">60 Days</button>
                    <button onclick="window.location.href='/profits-reports/90'">90 Days</button>
                    <button onclick="window.location.href='/profits-reports/365'">1 Year</button>
                </div>
                <button style="background: none; border: none; color: #333; font-size: 17px; padding: 14px 0; margin: 0 18px; border-radius: 5px; text-align: left; opacity: 0.7;" onclick="window.location.href='https://topcola.onrender.com/admin'; return false;">Admin</button>
                <button style="background: none; border: none; color: #333; font-size: 17px; padding: 14px 0; margin: 0 18px; border-radius: 5px; text-align: left; opacity: 0.7;" onclick="window.open('https://supabase.com/dashboard/project/otnrvaybkwsvzxgwfhfc/editor', '_blank'); return false;">Database</button>
            </div>
            <img src="/static/ndc.png" alt="Nicholson Digital Co." class="nav-logo" />
        </nav>
        <div class="main-content">
            <div class="admin-container" style="display: flex; flex-direction: row; min-height: 600px;">
                <!-- Tabs on the left -->
                <div id="admin-tabs" style="display: flex; flex-direction: column; align-items: flex-start; gap: 0; min-width: 210px; border-right: 1px solid #ddd; padding: 24px 0 0 0; background: #f9f9f9;">
                    <button id="tab-add-product" type="button" class="tab-btn active" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">Product</button>
                    <button id="tab-add-flower" type="button" class="tab-btn" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">Flower</button>
                    <button id="tab-add-bxgo-group" type="button" class="tab-btn" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">BXGO Group</button>
                    <button id="tab-add-promo-code" type="button" class="tab-btn" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">Promo Code</button>
                    <button id="tab-add-tag" type="button" class="tab-btn" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">Tag</button>
                    <button id="tab-add-flower-price-tier" type="button" class="tab-btn" style="border-radius: 6px 0 0 6px; border-bottom: 1px solid #ccc; border-right: none; width: 100%; text-align: left;">Flower Price Tier</button>
                </div>
                <!-- Render container on the right -->
                <div style="flex: 1; padding: 24px 0 0 32px; min-width: 0;">
                    <!-- Delete Old Product Modal -->
                    <div id="delete-product-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:3000; align-items:center; justify-content:center;">
                      <div style="background:#fff; border-radius:8px; padding:32px 28px 24px 28px; min-width:320px; box-shadow:0 2px 16px rgba(0,0,0,0.12); position:relative; display:flex; flex-direction:column; gap:18px; align-items:center;">
                        <span id="close-delete-product-modal" style="position:absolute; top:10px; right:16px; font-size:22px; color:#888; cursor:pointer;">&times;</span>
                        <h2 style="margin:0 0 10px 0; font-size:22px;">Delete Old Product</h2>
                        <label for="delete-product-id" style="font-weight:bold;">ID</label>
                        <input type="text" id="delete-product-id" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px; width:100%;">
                        <button id="delete-product-btn" style="background:#d32f2f; color:#fff; width:100%; font-size:16px; border:none; border-radius:5px; padding:10px; margin-top:10px; cursor:pointer;">Delete Product</button>
                        <div id="delete-product-message" style="margin-top:8px; text-align:center;"></div>
                      </div>
                    </div>

                    <!-- Delete Old Flower Modal -->
                    <div id="delete-weighted-product-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); z-index:3000; align-items:center; justify-content:center;">
                      <div style="background:#fff; border-radius:8px; padding:32px 28px 24px 28px; min-width:320px; box-shadow:0 2px 16px rgba(0,0,0,0.12); position:relative; display:flex; flex-direction:column; gap:18px; align-items:center;">
                        <span id="close-delete-weighted-product-modal" style="position:absolute; top:10px; right:16px; font-size:22px; color:#888; cursor:pointer;">&times;</span>
                        <h2 style="margin:0 0 10px 0; font-size:22px;">Delete Old Flower Product</h2>
                        <label for="delete-weighted-product-id" style="font-weight:bold;">ID</label>
                        <input type="text" id="delete-weighted-product-id" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px; width:100%;">
                        <button id="delete-weighted-product-btn" style="background:#d32f2f; color:#fff; width:100%; font-size:16px; border:none; border-radius:5px; padding:10px; margin-top:10px; cursor:pointer;">Delete Flower</button>
                        <div id="delete-weighted-product-message" style="margin-top:8px; text-align:center;"></div>
                      </div>
                    </div>

                    <div id="add-product-section">
                        <div style="display:flex; justify-content:flex-start; margin-bottom:10px;">
                          <button id="open-delete-product-modal" type="button" style="background:none; color:#d32f2f; font-size:14px; border:none; border-radius:5px; padding:4px 0; margin-bottom:8px; cursor:pointer; opacity:0.7; transition:opacity 0.2s; text-align:left; min-width:0;">Delete Old Product</button>
                        </div>
                        <form id="admin-form" onsubmit="event.preventDefault(); submitProduct();">
                            <label for="product-name">Product Name*</label>
                            <input type="text" id="product-name" required>

                            <div style="display: flex; gap: 12px; align-items: flex-end;">
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="product-price">Price ($)*</label>
                                    <input type="number" id="product-price" step="0.01" min="0" required>
                                </div>
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="product-cost">Cost ($)*</label>
                                    <input type="number" id="product-cost" step="0.01" min="0" required>
                                </div>
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="product-original-price">Original Price ($)</label>
                                    <input type="number" id="product-original-price" step="0.01" min="0">
                                </div>
                            </div>

                            <label for="product-group">Group</label>
                            <input type="text" id="product-group">

                            <label for="product-description">Description</label>
                            <textarea id="product-description" rows="3"></textarea>

                            <div style="display: flex; gap: 10px; align-items: flex-start;">
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="product-tags">Tags</label>
                                    <div id="tags-input-container" style="display: flex; flex-wrap: wrap; gap: 5px; border: 1px solid #ccc; border-radius: 5px; padding: 3px 5px !important; min-height: 32px !important; background: #fafafa;">
                                        <input type="text" id="product-tags-input" style="border: none; outline: none; flex: 1; min-width: 100px; background: transparent; font-size: 16px;" placeholder="Type a tag and press space...">
                                    </div>
                                    <script>
                                    // Tag input logic (frontend only, does not send data yet)
                                    const tagsInput = document.getElementById('product-tags-input');
                                    const tagsContainer = document.getElementById('tags-input-container');
                                    let tags = [];
                                    tagsInput.addEventListener('keydown', function(e) {
                                        if (e.key === ' ' && tagsInput.value.trim() !== '') {
                                            e.preventDefault();
                                            const tag = tagsInput.value.trim();
                                            tags.push(tag);
                                            const tagElem = document.createElement('span');
                                            tagElem.style.cssText = 'background:#e0e0e0; border-radius:3px; padding:2px 8px 2px 8px; margin-right:3px; display:inline-flex; align-items:center; gap:4px;';
                                            tagElem.textContent = tag;
                                            // Add remove button (x)
                                            const removeBtn = document.createElement('span');
                                            removeBtn.textContent = '×';
                                            removeBtn.style.cssText = 'margin-left:6px; color:#888; cursor:pointer; font-weight:bold;';
                                            removeBtn.onclick = function(e) {
                                                e.stopPropagation();
                                                tagsContainer.removeChild(tagElem);
                                                tags = tags.filter(t => t !== tag);
                                            };
                                            tagElem.appendChild(removeBtn);
                                            tagsContainer.insertBefore(tagElem, tagsInput);
                                            tagsInput.value = '';
                                        }
                                    });
                                    </script>
                                </div>
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="product-options">Options</label>
                                    <div id="options-input-container" style="display: flex; flex-wrap: wrap; gap: 5px; border: 1px solid #ccc; border-radius: 5px; padding: 3px 5px !important; min-height: 32px !important; background: #fafafa; margin-bottom: 10px;">
                                        <input type="text" id="product-options-input" style="border: none; outline: none; flex: 1; min-width: 100px; background: transparent; font-size: 16px;" placeholder="Type an option and press space...">
                                    </div>
                                    <script>
                                    // Option input logic (frontend only, does not send data yet)
                                    const optionsInput = document.getElementById('product-options-input');
                                    const optionsContainer = document.getElementById('options-input-container');
                                    let options = [];
                                    optionsInput.addEventListener('keydown', function(e) {
                                        if (e.key === ' ' && optionsInput.value.trim() !== '') {
                                            e.preventDefault();
                                            const option = optionsInput.value.trim();
                                            options.push(option);
                                            const optionElem = document.createElement('span');
                                            optionElem.style.cssText = 'background:#e0e0e0; border-radius:3px; padding:2px 8px 2px 8px; margin-right:3px; display:inline-flex; align-items:center; gap:4px;';
                                            optionElem.textContent = option;
                                            // Add remove button (x)
                                            const removeBtn = document.createElement('span');
                                            removeBtn.textContent = '×';
                                            removeBtn.style.cssText = 'margin-left:6px; color:#888; cursor:pointer; font-weight:bold;';
                                            removeBtn.onclick = function(e) {
                                                e.stopPropagation();
                                                optionsContainer.removeChild(optionElem);
                                                options = options.filter(t => t !== option);
                                            };
                                            optionElem.appendChild(removeBtn);
                                            optionsContainer.insertBefore(optionElem, optionsInput);
                                            optionsInput.value = '';
                                        }
                                    });
                                    </script>
                                </div>
                            </div>

                            <label for="product-images">Images</label>
                            <div id="images-upload-container" style="border: 2px dashed #ccc; border-radius: 5px; padding: 12px !important; background: #fafafa; text-align: center; margin-bottom: 6px !important; cursor: pointer;">
                                <span id="images-upload-text">Drag & drop images here or click to upload</span>
                                <input type="file" id="product-images-input" accept="image/*" multiple style="display: none;">
                                <div id="images-preview" style="display: flex; flex-wrap: wrap; gap: 6px !important; margin-top: 6px !important;"></div>
                            </div>
                            <script>
                            // Image upload logic (frontend only, does not send data yet)
                            const imagesUploadContainer = document.getElementById('images-upload-container');
                            const imagesInput = document.getElementById('product-images-input');
                            const imagesPreview = document.getElementById('images-preview');
                            const imagesUploadText = document.getElementById('images-upload-text');

                            imagesUploadContainer.addEventListener('click', () => imagesInput.click());

                            imagesUploadContainer.addEventListener('dragover', function(e) {
                                e.preventDefault();
                                imagesUploadContainer.style.borderColor = '#007bff';
                            });
                            imagesUploadContainer.addEventListener('dragleave', function(e) {
                                e.preventDefault();
                                imagesUploadContainer.style.borderColor = '#ccc';
                            });
                            imagesUploadContainer.addEventListener('drop', function(e) {
                                e.preventDefault();
                                imagesUploadContainer.style.borderColor = '#ccc';
                                handleFiles(e.dataTransfer.files);
                            });
                            imagesInput.addEventListener('change', function(e) {
                                handleFiles(e.target.files);
                            });
                            function handleFiles(files) {
                                imagesPreview.innerHTML = '';
                                for (let i = 0; i < files.length; i++) {
                                    const file = files[i];
                                    const reader = new FileReader();
                                    reader.onload = function(e) {
                                        const imgWrapper = document.createElement('div');
                                        imgWrapper.style.position = 'relative';
                                        imgWrapper.style.display = 'inline-block';

                                        const img = document.createElement('img');
                                        img.src = e.target.result;
                                        img.style.maxWidth = '80px';
                                        img.style.maxHeight = '80px';
                                        img.style.borderRadius = '5px';
                                        imgWrapper.appendChild(img);

                                        // Add remove button (white x)
                                        const removeBtn = document.createElement('span');
                                        removeBtn.textContent = '×';
                                        removeBtn.style.cssText = 'position:absolute;top:2px;right:6px;background:rgba(255,255,255,0.85);color:#333;border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;box-shadow:0 1px 4px rgba(0,0,0,0.08);z-index:2;';
                                        removeBtn.onclick = function() {
                                            imagesPreview.removeChild(imgWrapper);
                                            // Remove file from imagesInput.files (not possible directly, so just clear all if any removed)
                                            // For now, clear all and let user re-add as needed
                                            imagesInput.value = '';
                                            imagesUploadText.style.display = imagesPreview.children.length === 0 ? 'inline' : 'none';
                                        };
                                        imgWrapper.appendChild(removeBtn);

                                        imagesPreview.appendChild(imgWrapper);
                                    };
                                    reader.readAsDataURL(file);
                                }
                                imagesUploadText.style.display = files.length ? 'none' : 'inline';
                            }
                            </script>

                            <button type="submit">Add Product</button>
                        </form>
                        <div id="admin-message"></div>
                        {% if error %}
                            <div class="error">{{ error }}</div>
                        {% endif %}
                    </div>
                    <div id="add-flower-section" style="display:none;">
                        <div style="display:flex; justify-content:flex-start; margin-bottom:10px;">
                          <button id="open-delete-weighted-product-modal" type="button" style="background:none; color:#d32f2f; font-size:14px; border:none; border-radius:5px; padding:4px 0; margin-bottom:8px; cursor:pointer; opacity:0.7; transition:opacity 0.2s; text-align:left; min-width:0;">Delete Old Flower Product</button>
                        </div>
                        <form id="weighted-admin-form" onsubmit="event.preventDefault(); submitWeightedProduct();">
                            <label for="weighted-product-name">Product Name*</label>
                            <input type="text" id="weighted-product-name" required>

                            <div style="display: flex; gap: 12px; align-items: flex-end;">
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="weighted-product-price">Price per g ($)*</label>
                                    <input type="number" id="weighted-product-price" step="0.01" min="0" required>
                                </div>
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="weighted-product-cost">Cost per g ($)*</label>
                                    <input type="number" id="weighted-product-cost" step="0.01" min="0" required>
                                </div>
                                <div style="flex: 1; display: flex; flex-direction: column;">
                                    <label for="weighted-product-price-tier">Price Tier*</label>
                                    <input type="number" id="weighted-product-price-tier" min="0" required>
                                </div>
                            </div>

                            <label for="weighted-product-description">Description</label>
                            <textarea id="weighted-product-description" rows="3"></textarea>

                            <label for="weighted-product-tags">Tags</label>
                            <div id="weighted-tags-input-container" style="display: flex; flex-wrap: wrap; gap: 5px; border: 1px solid #ccc; border-radius: 5px; padding: 3px 5px !important; min-height: 32px !important; background: #fafafa;">
                                <input type="text" id="weighted-product-tags-input" style="border: none; outline: none; flex: 1; min-width: 100px; background: transparent; font-size: 16px;" placeholder="Type a tag and press space...">
                            </div>
                            <script>
                            // Tag input logic for weighted product
                            const weightedTagsInput = document.getElementById('weighted-product-tags-input');
                            const weightedTagsContainer = document.getElementById('weighted-tags-input-container');
                            let weightedTags = [];
                            weightedTagsInput.addEventListener('keydown', function(e) {
                                if (e.key === ' ' && weightedTagsInput.value.trim() !== '') {
                                    e.preventDefault();
                                    const tag = weightedTagsInput.value.trim();
                                    weightedTags.push(tag);
                                    const tagElem = document.createElement('span');
                                    tagElem.style.cssText = 'background:#e0e0e0; border-radius:3px; padding:2px 8px 2px 8px; margin-right:3px; display:inline-flex; align-items:center; gap:4px;';
                                    tagElem.textContent = tag;
                                    // Add remove button (x)
                                    const removeBtn = document.createElement('span');
                                    removeBtn.textContent = '×';
                                    removeBtn.style.cssText = 'margin-left:6px; color:#888; cursor:pointer; font-weight:bold;';
                                    removeBtn.onclick = function(e) {
                                        e.stopPropagation();
                                        weightedTagsContainer.removeChild(tagElem);
                                        weightedTags = weightedTags.filter(t => t !== tag);
                                    };
                                    tagElem.appendChild(removeBtn);
                                    weightedTagsContainer.insertBefore(tagElem, weightedTagsInput);
                                    weightedTagsInput.value = '';
                                }
                            });
                            </script>

                            <label for="weighted-product-images">Images</label>
                            <div id="weighted-images-upload-container" style="border: 2px dashed #ccc; border-radius: 5px; padding: 12px !important; background: #fafafa; text-align: center; margin-bottom: 6px !important; cursor: pointer;">
                                <span id="weighted-images-upload-text">Drag & drop images here or click to upload</span>
                                <input type="file" id="weighted-product-images-input" accept="image/*" multiple style="display: none;">
                                <div id="weighted-images-preview" style="display: flex; flex-wrap: wrap; gap: 6px !important; margin-top: 6px !important;"></div>
                            </div>
                            <script>
                            // Image upload logic for weighted product
                            const weightedImagesUploadContainer = document.getElementById('weighted-images-upload-container');
                            const weightedImagesInput = document.getElementById('weighted-product-images-input');
                            const weightedImagesPreview = document.getElementById('weighted-images-preview');
                            const weightedImagesUploadText = document.getElementById('weighted-images-upload-text');

                            weightedImagesUploadContainer.addEventListener('click', () => weightedImagesInput.click());

                            weightedImagesUploadContainer.addEventListener('dragover', function(e) {
                                e.preventDefault();
                                weightedImagesUploadContainer.style.borderColor = '#007bff';
                            });
                            weightedImagesUploadContainer.addEventListener('dragleave', function(e) {
                                e.preventDefault();
                                weightedImagesUploadContainer.style.borderColor = '#ccc';
                            });
                            weightedImagesUploadContainer.addEventListener('drop', function(e) {
                                e.preventDefault();
                                weightedImagesUploadContainer.style.borderColor = '#ccc';
                                handleWeightedFiles(e.dataTransfer.files);
                            });
                            weightedImagesInput.addEventListener('change', function(e) {
                                handleWeightedFiles(e.target.files);
                            });
                            function handleWeightedFiles(files) {
                                weightedImagesPreview.innerHTML = '';
                                for (let i = 0; i < files.length; i++) {
                                    const file = files[i];
                                    const reader = new FileReader();
                                    reader.onload = function(e) {
                                        const imgWrapper = document.createElement('div');
                                        imgWrapper.style.position = 'relative';
                                        imgWrapper.style.display = 'inline-block';

                                        const img = document.createElement('img');
                                        img.src = e.target.result;
                                        img.style.maxWidth = '80px';
                                        img.style.maxHeight = '80px';
                                        img.style.borderRadius = '5px';
                                        imgWrapper.appendChild(img);

                                        // Add remove button (white x)
                                        const removeBtn = document.createElement('span');
                                        removeBtn.textContent = '×';
                                        removeBtn.style.cssText = 'position:absolute;top:2px;right:6px;background:rgba(255,255,255,0.85);color:#333;border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;box-shadow:0 1px 4px rgba(0,0,0,0.08);z-index:2;';
                                        removeBtn.onclick = function() {
                                            weightedImagesPreview.removeChild(imgWrapper);
                                            weightedImagesInput.value = '';
                                            weightedImagesUploadText.style.display = weightedImagesPreview.children.length === 0 ? 'inline' : 'none';
                                        };
                                        imgWrapper.appendChild(removeBtn);

                                        weightedImagesPreview.appendChild(imgWrapper);
                                    };
                                    reader.readAsDataURL(file);
                                }
                                weightedImagesUploadText.style.display = files.length ? 'none' : 'inline';
                            }
                            </script>

                            <button type="submit">Add Weighted Product</button>
                        </form>
                        <div id="weighted-admin-message"></div>
                    </div>
                    <div id="add-bxgo-group-section" style="display:none;">
                        <form id="add-bxgo-group-form" onsubmit="event.preventDefault(); submitBXGOGroup();" style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px;">
                            <label for="bxgo-group">Group Name*</label>
                            <input type="text" id="bxgo-group" name="bxgo-group" required autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label><input type="checkbox" id="bogo" name="bogo"> BOGO</label>
                            <label><input type="checkbox" id="b2go" name="b2go"> B2GO</label>
                            <label><input type="checkbox" id="b3go" name="b3go"> B3GO</label>
                            <button type="submit">Add BXGO Group</button>
                            <div id="add-bxgo-group-message" style="margin-top:8px; text-align:center;"></div>
                        </form>
                    </div>
                    <div id="add-promo-code-section" style="display:none;">
                        <form id="add-promo-code-form" onsubmit="event.preventDefault(); submitPromoCode();" style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px;">
                            <label for="promo-code">Promo Code*</label>
                            <input type="text" id="promo-code" name="promo-code" required autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="dollars-off">Dollars Off</label>
                            <input type="number" id="dollars-off" name="dollars-off" step="0.01" min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="percent-off">Percent Off</label>
                            <input type="number" id="percent-off" name="percent-off" min="0" max="100" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <button type="submit">Add Promo Code</button>
                            <div id="add-promo-code-message" style="margin-top:8px; text-align:center;"></div>
                        </form>
                    </div>
                    <div id="add-tag-section" style="display:none;">
                        <form id="add-tag-form" onsubmit="event.preventDefault(); submitTag();" style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px;">
                            <label for="tag-name">Tag Name*</label>
                            <input type="text" id="tag-name" name="tag-name" required autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <button type="submit">Add Tag</button>
                            <div id="add-tag-message" style="margin-top:8px; text-align:center;"></div>
                        </form>
                    </div>
                    <div id="add-flower-price-tier-section" style="display:none;">
                        <form id="add-flower-price-tier-form" onsubmit="event.preventDefault(); submitFlowerPriceTier();" style="display: flex; flex-direction: column; gap: 10px; width: 100%; max-width: 400px;">
                            <label for="tier">Tier*</label>
                            <input type="number" id="tier" name="tier" required min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="discount-4g">4g Discount ($)</label>
                            <input type="number" id="discount-4g" name="discount-4g" step="0.01" min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="discount-7g">7g Discount ($)</label>
                            <input type="number" id="discount-7g" name="discount-7g" step="0.01" min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="discount-14g">14g Discount ($)</label>
                            <input type="number" id="discount-14g" name="discount-14g" step="0.01" min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <label for="discount-28g">28g Discount ($)</label>
                            <input type="number" id="discount-28g" name="discount-28g" step="0.01" min="0" autocomplete="off" style="padding:8px; font-size:16px; border:1px solid #ccc; border-radius:4px;">
                            <button type="submit">Add Flower Price Tier</button>
                            <div id="add-flower-price-tier-message" style="margin-top:8px; text-align:center;"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    function submitWeightedProduct() {
        const product_name = document.getElementById('weighted-product-name').value.trim();
        const price = parseFloat(document.getElementById('weighted-product-price').value);
        const cost = parseFloat(document.getElementById('weighted-product-cost').value);
        const description = document.getElementById('weighted-product-description').value;
        const price_tier = parseInt(document.getElementById('weighted-product-price-tier').value);
        const imagesInput = document.getElementById('weighted-product-images-input');

        if (!product_name || isNaN(price) || isNaN(cost) || isNaN(price_tier)) {
            showWeightedMessage('Please fill out all required fields.', false);
            return;
        }

        const payload = {
            product_name,
            price,
            cost,
            price_tier
        };
        if (description && description.trim() !== "") payload.description = description.trim();
        if (weightedTags.length > 0) payload.tags = weightedTags;

        // Prepare form data for images
        const formData = new FormData();
        for (let i = 0; i < imagesInput.files.length; i++) {
            formData.append('images', imagesInput.files[i]);
        }
        formData.append('payload', JSON.stringify(payload));
        formData.append('bucket', 'weighted-product-images');

        fetch('/api/add-weighted-product', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                showWeightedMessage(data.message, true);
                document.getElementById('weighted-admin-form').reset();
                weightedTags = [];
                document.getElementById('weighted-tags-input-container').querySelectorAll('span').forEach(e => e.remove());
                weightedImagesPreview.innerHTML = '';
                weightedImagesUploadText.style.display = 'inline';
            } else {
                showWeightedMessage('Weighted product could not be added. Please ensure all tags can be found in the admin console.', false);
            }
        })
        .catch(error => {
            showWeightedMessage('Weighted product could not be added. Please ensure all tags can be found in the admin console.', false);
        });
    }
    function showWeightedMessage(msg, success) {
        const msgDiv = document.getElementById('weighted-admin-message');
        msgDiv.textContent = msg;
        msgDiv.className = success ? 'success' : 'error';
    }
    </script>
</body>
</html>

