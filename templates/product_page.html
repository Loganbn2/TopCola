<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Albert+Sans:wght@400;700&display=swap');

        body {
            font-family: 'Albert Sans', sans-serif;
        }
        .product-container {
            display: flex;
            gap: 20px;
            color: #333;
            padding: 20px;
            padding-top: 50px;
            border-radius: 5px;
            width: 80%;
            margin: 20px auto;
            align-items: center; /* Center contents vertically */
        }
        .left-column, .right-column {
            flex: 1;
        }
        .left-column {
            flex: 1;
            align-self: flex-start; /* Align contents to the top */
        }
        .image-gallery {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .primary-image {
            height: 375px; /* Increased by 25% */
            width: 487.5px; /* Increased by 25% */
            border-radius: 15px;
            margin-bottom: 10px;
            object-fit: cover;
        }
        .thumbnail-carousel {
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }
        .thumbnail-carousel img {
            height: 80px; /* Increased by 25% */
            width: 100px; /* Increased by 25% */
            border-radius: 10px;
            cursor: pointer;
            object-fit: cover;
        }
        .thumbnail-carousel img:hover {
            border: 1px solid #333;
        }
        .product-name {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .product-description {
            margin: 10px;
            margin-top: 40px;
            margin-bottom: 25px;
            margin-left: 40px;
            white-space: pre-line;
            font-size: 16px;
            line-height: 1.3;
        }
        .product-price {
            font-size: 24px;
            color: black;
            font-weight: 500;
        }
        .original-price {
            font-size: 20px;
            color: rgb(136, 136, 136);
            text-decoration: line-through;
            margin-right: 10px;
        }
        .error-message {
            color: red;
        }
        .quantity-dropdown {
            margin-top: 15px;
            font-size: 16px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quantity-dropdown:hover {
            border-color: #333;
        }
        .add-to-cart-button {
            margin-left: 30px;
            padding: 10px 25px;
            font-size: 16px;
            color: black;
            background-color: white;
            border: solid 1px black;
            border-radius: 10px;
            cursor: pointer;
        }
        .add-to-cart-button:hover {
            background-color: black;
            color: white;
        }
        .subtotal-line {
            margin-top: 30px;
            font-size: 18px;
            font-weight: 500;
            color: #333;
            padding: 10px;
            border-radius: 5px;
        }
        .discount-line {
            font-size: 18px;
            font-weight: 500;
            color: #157831;
            padding: 10px;
            border-radius: 5px;
        }
        .total-line {
            margin-top: 15px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
    <script>
        function updatePrimaryImage(src) {
            document.getElementById('primary-image').src = src;
        }
        function updateSubtotal() {
            const quantity = document.getElementById('quantity-dropdown').value;
            const originalPrice = {{ "%.2f"|format(product.original_price) }};
            const standardDiscount = {{ "%.2f"|format(product.standard_discount) }};
            const subtotal = (quantity * originalPrice).toFixed(2);
            const discount = (quantity * standardDiscount).toFixed(2);
            const total = (subtotal - discount).toFixed(2); // Calculate total
            document.getElementById('subtotal').textContent = `$${subtotal}`;
            document.getElementById('discount').textContent = `-$${discount}`;
            document.getElementById('total').textContent = `$${total}`; // Update total
        }
        function addToCart() {
            const productName = "{{ product.product_name }}";
            const productID = "{{ product.id }}"; // Ensure productID is defined
            const quantity = document.getElementById('quantity-dropdown').value;
            const total = document.getElementById('total').textContent;
            const productGroup = "{{ product.group }}";
            let selectedOption = null;
            const optionsDropdown = document.getElementById('options-dropdown');
            if (optionsDropdown) {
                selectedOption = optionsDropdown.value;
            }

            // Retrieve existing cart items from local storage
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Add new line item to the cart, including selectedOption if present
            cart.push({ productName, productID, quantity, total, productGroup, option: selectedOption });

            // Save updated cart back to local storage
            localStorage.setItem('cart', JSON.stringify(cart));

            console.log('Updated Cart:', cart); // Log the updated cart for debugging

            alert('Item added to cart: ' + productName + ' (ID: ' + productID + ', Group: ' + productGroup + ', Quantity: ' + quantity + ', Total: ' + total + (selectedOption ? ', Option: ' + selectedOption : '') + ')');
        }
    </script>
</head>
<body>
    <div class="product-container">
        {% if product %}
            <div class="left-column">
                <div class="image-gallery">
                    <!-- Primary Image -->
                    <img id="primary-image" class="primary-image" src="https://otnrvaybkwsvzxgwfhfc.supabase.co/storage/v1/object/public/product-images/{{ product.images[0] }}" alt="Primary Product Image">
                    
                    <!-- Thumbnail Carousel -->
                    <div class="thumbnail-carousel">
                        {% for image_url in product.images %}
                            <img src="https://otnrvaybkwsvzxgwfhfc.supabase.co/storage/v1/object/public/product-images/{{ image_url }}" alt="Thumbnail" onclick="updatePrimaryImage(this.src)">
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="right-column">
                <div class="product-name">{{ product.product_name }}</div>
                <div class="product-price">
                    {% if product.original_price and product.original_price != product.price %}
                        <span class="original-price">${{ "%.2f"|format(product.original_price) }}</span>
                    {% endif %}
                    <span>${{ "%.2f"|format(product.price) }}</span>
                </div>
                <div class="product-description">{{ product.description }}</div>

                {# Options Dropdown #}
                {% if product.options and product.options|length > 0 %}
                    <div style="margin-bottom: 10px;">
                        <label for="options-dropdown" style="font-size: 16px; font-weight: 500; margin-right: 10px;">Options:</label>
                        <select id="options-dropdown" class="quantity-dropdown" style="margin-top: 0;">
                            {% for option in product.options %}
                                <option value="{{ option }}">{{ option }}</option>
                            {% endfor %}
                        </select>
                    </div>
                {% endif %}

                <div>
                    <select class="quantity-dropdown" id="quantity-dropdown" onchange="updateSubtotal()">
                        {% for i in range(1, 11) %}
                            <option value="{{ i }}">{{ i }}</option>
                        {% endfor %}
                    </select>
                    <button class="add-to-cart-button" onclick="addToCart()">Add to Cart</button>
                </div>
                <div class="subtotal-line">
                    Subtotal: <span id="subtotal">${{ "%.2f"|format(product.original_price) }}</span>
                </div>
                <div class="discount-line">
                    Discounts: <span id="discount">-${{ "%.2f"|format(product.standard_discount) }}</span>
                </div>
                <hr style="margin: 20px 0; border: 1px solid #ccc;">
                <div class="total-line">
                    Total: <span id="total">${{ "%.2f"|format(product.original_price - product.standard_discount) }}</span>
                </div>
                {% if product.BOGO or product.B2GO or product.B3GO %}
                    <p style="margin-top: 10px; font-size: 16px; color: #555;">
                        *BOGO, B2GO & B3GO discounts are displayed in Cart.
                    </p>
                {% endif %}
            </div>
        {% elif error %}
            <p class="error-message">{{ error }}</p>
        {% else %}
            <p class="error-message">No product information available.</p>
        {% endif %}
    </div>
</body>
</html>